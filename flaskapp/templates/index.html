<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>jQuery UI Datepicker - Select a Date Range</title>
  <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script src="{{url_for('static', filename='js/covidcor.js')}}"></script>
<!--  For sort table-->
  <link rel="stylesheet" href="//cdn.datatables.net/1.10.23/css/jquery.dataTables.min.css">
  <script src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.min.js"></script>


  <script>
  /*Set default input for dates when document is ready*/
  $( document ).ready(function() {
    //loadConfigFile();
    console.log( "ready!" );
    var now = new Date();
    var today = now.getFullYear() + '-' + ('0' + (now.getMonth() + 1)).slice(-2) + '-' + ('0' + now.getDate()).slice(-2);
    $('#date-input2').val(today);
    submit_request();
    //submit_request2();
  });

  $(function() {
      $('#submit').on('click', function(){
          submit_request();
      });
  });

  function submit_request() {
          /*Make the query dates */
          var date1 = new Date($('#date-input1').val());
          day1 = date1.getDate();
          month1 = date1.getMonth() + 1;
          year1 = date1.getFullYear();

          var date2 = new Date($('#date-input2').val());
          day2 = date2.getDate();
          month2 = date2.getMonth() + 1;
          year2 = date2.getFullYear();

          /*Make the request urls*/
          //var host = location.hostname;
          //var port = location.port;
          //var pathname = location.pathname;

          var href = location.href
          var url = href + "query_covid_stock_chart"
          var url2 = href + "query_covid_topk_us"
          var url3 = href + "query_covid_topk_global"

          url = url.concat('?', 'start_date=', [year1, month1, day1].join('-'))
          url = url.concat('&', 'end_date=', [year2, month2, day2].join('-'))
          $.get(url, function( data ) {
              $('#content').html(data);
          });

          url2 = url2.concat('?', 'start_date=', [year1, month1, day1].join('-'))
          url2 = url2.concat('&', 'end_date=', [year2, month2, day2].join('-'))
          url2 = url2.concat('&', 'topk=',10)
          $.get(url2, function( data ) {
              //constructTable is defined in covidcor.js
              $('#content2').append($('<div/>').html("Top 10 states by number of cases"));
              $('#content2').append($('<table/>').attr({"align":"left", "id":"table1", "border":"1"}));
              constructTable(data, 'table1');
              //$('#table1').DataTable();
          });

          url3 = url3.concat('?', 'start_date=', [year1, month1, day1].join('-'))
          url3 = url3.concat('&', 'end_date=', [year2, month2, day2].join('-'))
          url3 = url3.concat('&', 'topk=',10)
          $.get(url3, function( data ) {
              //constructTable is defined in covidcor.js
              $('#content3').append($('<div/>').html("Top 10 countries by number of cases"));
              $('#content3').append($('<table/>').attr({"align":"left", "id":"table2", "border":"1"}));
              constructTable(data, 'table2');

          });
  }



  </script>
</head>
<body>

<input type="date" id="date-input1" value="2020-01-02" required />
<input type="date" id="date-input2" required />
<button id="submit">Submit</button>
<div id=content>
</div>

<div class="row">
  <div class="col">
    <div id=content2></div>
  </div>
  <div class="col">
     <div id=content3></div>
  </div>
<!--  <table align = "center"-->
<!--                id="table" border="1">-->
<!--</table>-->
</div>




</body>
</html>
